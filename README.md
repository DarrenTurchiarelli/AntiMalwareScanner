# AntiMalwareScanner

Uploading files and want to scan them in real time ? 

Do you have a service offering that requires customers or potential customers to upload documents? Ultimately this content will reside within a storage account that can later be used for other purposes, such as leveraging ML to analyse the data or AI to make intelligent decisions. As documents are being uploaded, if they are not scanned by an antimalware solution, they may contain malicious content which can cause havoc in your environment. So, let’s look at implementing an anti-malware scanner to scan the content as it's being uploaded and if it doesn't come back with a clean bill of health, then we will dump it! 

Requirements:
•	A Storage Account that contains a blob container. (This will be the destination of the uploaded files)
•	A service principal/Managed Identity (This will allow the logic app and storage account to securely communicate with each other) 
•	A logic app 
•	A Cloudmersive account (Antimalware scanner - API). There is a Microsoft Defender solution in NDA

Identity
In this tutorial I will be using a System Managed Identity (SMI). If you decide to use a service principal, I recommend that your store the secret in Azure Key Vault during the time of creation as you will not be able to retrieve the secret once it has been generated from Azure Active Directory. 
Storage Account
Create a Storage account and subsequently a container from the 'Data Storage' heading within the blade. Please note for this solution to work the storage account must be V2. If you have a generation one storage account, you can upgrade it from the Overview tab.

Logic App 
The next step is to create a logic app to house the solution. Below are the plans that are available. As this is a POC, I am using a consumption plan but if you are looking to deploy this in an enterprise environment then I would encourage you to leverage the ‘standard’ plan.

The plan type you choose dictates how your app scales, what features are enabled, and how it is priced
Plan type
•	Standard: Best for enterprise-level, serverless applications, with event-based scaling and networking isolation.
•	Consumption:  Best for entry-level. Pay only as much as your workflow runs.












Validating the solution:

The European Institute for Computer Antivirus Research (EICAR) has developed a test virus to test your antivirus appliance. This script is an inert text file. The binary pattern is included in the virus pattern file from most antivirus vendors. The test virus is not a virus and does not contain any program code.

Never use real viruses to test your Internet security.
Download the EICAR test virus from the following URL: http://www.eicar.org/download/eicar.com.txt

Alternatively, you can create your own EICAR test virus by typing or copying the following into a text file, and then naming the file eicar.com:
X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*

Once you have created this file, upload it to your container, whilst watching your logic app run in real time to validate the file gets deleted. 
